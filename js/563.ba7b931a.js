"use strict";(self["webpackChunkrx"]=self["webpackChunkrx"]||[]).push([[563],{6563:function(t,a,s){s.r(a),s.d(a,{default:function(){return c}});var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"shopbag"},[a("van-nav-bar",{attrs:{title:"购物车","left-text":"返回","left-arrow":"",fixed:""},on:{"click-left":t.back,"click-right":function(a){t.isEdit=!t.isEdit}},scopedSlots:t._u([{key:"right",fn:function(){return[t.shopbagData.length>0?a("div",{staticClass:"shouye"},[a("span",[t._v(t._s(t.isEdit?"完成":"编辑"))])]):t._e()]},proxy:!0}])}),t._m(0),a("br"),a("br"),a("br"),a("br"),0==t.shopbagData.length?a("div",[a("van-empty",{attrs:{description:"购物车空空如也，去逛逛"}},[a("van-button",{staticClass:"bottom-button",attrs:{round:"",color:"#1A73E8"},on:{click:function(a){return t.getMain()}}},[t._v(" 逛一逛 ")])],1)],1):a("div",{staticClass:"shopbag-box"},[a("div",{staticClass:"shopbag-bg"},[a("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",offset:"20"},on:{load:t.loadData},model:{value:t.loading,callback:function(a){t.loading=a},expression:"loading"}},[a("div",{staticClass:"shopbag-product"},t._l(t.shopbagData,(function(s,e){return a("div",{key:s.sid,staticClass:"shopbag-item"},[a("div",{staticClass:"cell-item"},[a("van-swipe-cell",{attrs:{disabled:t.isEdit},scopedSlots:t._u([{key:"right",fn:function(){return[a("van-button",{staticClass:"delete-button",attrs:{square:"",type:"danger",text:"删除"},on:{click:function(a){return t.removeOne(e,s.sid)}}})]},proxy:!0}],null,!0)},[a("div",{staticClass:"clearfix cell-item-box"},[a("div",{staticClass:"check-box fl"},[a("van-checkbox",{attrs:{"checked-color":"#1A73E8"},on:{change:t.simpleSelect},model:{value:s.isChecked,callback:function(a){t.$set(s,"isChecked",a)},expression:"item.isChecked"}})],1),a("div",{staticClass:"fl pro-info-box"},[a("div",{staticClass:"fl pro-img"},[a("img",{staticClass:"auto-img",attrs:{src:s.small_img,alt:""}})]),a("div",{staticClass:"fl pro-info"},[a("div",{staticClass:"pro-info-text"},[a("div",{staticClass:"names clearfix"},[a("div",{staticClass:"fl pro-name"},[t._v(t._s(s.name))]),a("div",{staticClass:"fl pro-rule"},[t._v(t._s(s.rule))])]),a("div",{staticClass:"pro-enname"},[t._v(t._s(s.enname))])]),a("div",{staticClass:"pro-count-box"},[a("div",{staticClass:"pro-price fl"},[t._v("￥"+t._s(s.price))]),a("div",{staticClass:"step-box fr"},[a("van-stepper",{attrs:{theme:"round","button-size":"20","disable-input":""},on:{change:function(a){return t.changCount(s)}},model:{value:s.count,callback:function(a){t.$set(s,"count",a)},expression:"item.count"}})],1)])])])])])],1)])})),0)])],1),t.isEdit?a("van-submit-bar",{attrs:{"button-text":"删除选择","button-color":"#EE0A24"},on:{submit:t.removeSelected}},[a("van-checkbox",{staticStyle:{width:"auto",height:"50px",position:"relative",right:"177px"},on:{click:t.allSelect},model:{value:t.isAllChecked,callback:function(a){t.isAllChecked=a},expression:"isAllChecked"}},[t._v(" 全选 ")])],1):a("van-submit-bar",{attrs:{price:t.total,"button-text":"提交订单","button-color":"#1A73E8"},on:{submit:t.commit}},[a("van-checkbox",{on:{click:t.allSelect},model:{value:t.isAllChecked,callback:function(a){t.isAllChecked=a},expression:"isAllChecked"}},[t._v(" 全选 ")])],1)],1)],1)},i=[function(){var t=this,a=t._self._c;return a("div",{staticClass:"icon"},[a("img",{attrs:{src:s(6700),alt:""}})])}],o={name:"Shopbag",data(){return{isCheck:!1,count:2,isAllChecked:!1,loading:!0,finished:!1,isEdit:!1,allShopbagData:[],dataCount:8,startIndex:0,shopbagData:[],total:0}},created(){this.getShopbagData()},methods:{back(){this.$router.go(-1)},getMain(){return this.$router.push({name:"Menu"})},getShopbagData(){let t=localStorage.getItem("token");if(!t)return this.$toast("请先登录"),void this.$router.push({name:"Login"});this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/findAllShopcart",params:{appkey:this.appkey,tokenString:t}}).then((t=>{this.$toast.clear(),console.log(t.data.result),700==t.data.code?this.$router.push({name:"Login"}):5e3==t.data.code&&(t.data.result.map((t=>{t.isChecked=!1})),this.allShopbagData=t.data.result,this.shopbagData=this.allShopbagData.slice(this.startIndex,this.startIndex+this.dataCount),this.startIndex+=this.dataCount,this.loading=!1)})).catch((t=>{this.$toast.clear()}))},loadData(){setTimeout((()=>{let t=this.allShopbagData.slice(this.startIndex,this.startIndex+this.dataCount);this.startIndex+=this.dataCount,this.shopbagData.push(...t),this.isAllChecked=!1,t.length<this.dataCount?this.finished=!0:this.loading=!1}),1500)},allSelect(){this.shopbagData.map((t=>{t.isChecked=this.isAllChecked})),this.sum()},simpleSelect(){this.sum();for(let t=0;t<this.shopbagData.length;t++)if(!this.shopbagData[t].isChecked)return void(this.isAllChecked=!1);this.isAllChecked=!0},removeOne(t,a){let s=localStorage.getItem("token");if(!s)return this.$toast("请先登录"),void this.$router.push({name:"Login"});this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.axios({method:"POST",url:"/deleteShopcart",data:{appkey:this.appkey,tokenString:s,sids:JSON.stringify([a])}}).then((a=>{location.reload(),this.$toast.caller(),700==a.data.code?this.$router.push({name:"Login"}):7e3==a.data.code&&(this.shopbagData.splice(t,1),this.sum()),this.$toast(a.data.msg)})).catch((t=>{this.$toast.clear()}))},isSelectProduct(t){for(let a=0;a<this.shopbagData.length;a++)if(this.shopbagData[a].isChecked)return!0;return!1},removeSelected(){let t=this.isSelectProduct();if(!t)return void this.$toast("请选择删除的商品");let a=[];this.shopbagData.map((t=>{t.isChecked&&a.push(t.sid)}));let s=localStorage.getItem("token");if(!s)return this.$toast("请先登录"),void this.$router.push({name:"Login"});this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.axios({method:"POST",url:"/deleteShopcart",data:{appkey:this.appkey,tokenString:s,sids:JSON.stringify(a)}}).then((t=>{if(this.$toast.clear(),700==t.data.code)this.$router.push({name:"Login"});else if(7e3==t.data.code){for(let t=0;t<this.shopbagData.length;t++)this.shopbagData[t].isChecked&&(this.shopbagData.splice(t,1),t--);this.sum()}this.$toast(t.data.msg)})).catch((t=>{this.$toast.clear()}))},changCount(t){let a=localStorage.getItem("token");if(!a)return this.$toast("请先登录"),void this.$router.push({name:"Login"});this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.axios({method:"POST",url:"/modifyShopcartCount",data:{appkey:this.appkey,tokenString:a,sid:t.sid,count:t.count}}).then((a=>{this.$toast.clear(),700==a.data.code?this.$router.push({name:"Login"}):6e3==a.data.code?t.isChecked&&this.sum:this.$toast(a.data.msg)})).catch((t=>{this.$toast.clear()}))},sum(){this.total=0,this.shopbagData.map((t=>{t.isChecked&&(this.total+=t.price*t.count)})),this.total*=100},commit(){let t=this.isSelectProduct();if(!t)return void this.$toast("请选择购买的商品");let a=[];this.shopbagData.map((t=>{t.isChecked&&a.push(t.sid)})),this.$router.push({name:"Pay",query:{sids:a.join("-")}})}}},l=o,n=s(1001),h=(0,n.Z)(l,e,i,!1,null,"5fa1ed06",null),c=h.exports},6700:function(t,a,s){t.exports=s.p+"img/shopbag_bg.e5b6cb81.png"}}]);
//# sourceMappingURL=563.ba7b931a.js.map
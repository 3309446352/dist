"use strict";(self["webpackChunkrx"]=self["webpackChunkrx"]||[]).push([[577],{9569:function(t,s,e){e.d(s,{Z:function(){return c}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"order-item"},[s("div",{staticClass:"cell-item-box"},[s("div",{staticClass:"pro-info-box"},[s("div",{staticClass:"pro-img"},[s("img",{staticClass:"auto-img",attrs:{src:t.item.small_img||t.item.smallImg,alt:""}})]),s("div",{staticClass:"pro-info fl"},[s("div",{staticClass:"pro-info-text"},[s("div",{staticClass:"names clearfix"},[s("div",{staticClass:"pro-name"},[t._v(t._s(t.item.name))]),s("div",{staticClass:"pro-rule"},[t._v(t._s(t.item.rule))])]),s("div",{staticClass:"pro-enname"},[t._v(t._s(t.item.enname))])]),s("div",{staticClass:"pro-count-box"},[s("div",{staticClass:"pro-price fl"},[t._v("￥"+t._s(t.item.price))]),s("div",{staticClass:"pro-count"},[t._v("X"+t._s(t.item.count))])])])])]),s("br")])},a=[],r={name:"OrderItem",props:{item:{type:Object,default(){return{name:"名称",rule:"规格",enname:"英文名称",prico:0,count:1}}}}},o=r,d=e(1001),l=(0,d.Z)(o,i,a,!1,null,"45b09ce7",null),c=l.exports},7020:function(t,s,e){e.d(s,{Z:function(){return c}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"order-list"},[s("div",{staticClass:"pro-box"},[s("div",{staticClass:"info-boxs clearfix"},[s("div",{staticClass:"info-title fl"},[t._v(t._s(t.infoTitleLeft))]),s("br"),s("br"),t.isRight?s("div",{staticClass:"re-info fl"},[t.isReceive?s("div",{staticClass:"clearfix"},[s("div",{staticClass:"fl"},[t._v("已完成")]),s("div",{staticClass:"fl delete",on:{click:t.remove}},[s("van-icon",{attrs:{name:"delete",size:"20"}})],1)]):s("div",{staticClass:"conf",on:{click:t.confirmReceive}},[t._v("确认收货")])]):t._e()]),s("div",[s("div",{staticClass:"cell-list"},[t._t("default")],2),s("div",{staticClass:"bottom-into"},[t._m(0),""!=t.date?s("div",{staticClass:"date"},[t._v(t._s(t.date))]):t._e(),s("div",{staticClass:"clearfix"},[s("div",{staticClass:"fl",staticStyle:{display:"block"}},[t._v("共计"+t._s(t.count)+"件商品")]),s("div",{staticClass:"fl total",staticStyle:{display:"block"}},[t._v("订单金额￥"+t._s(t.total))])])])])])])},a=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"circle"},[s("div",{staticClass:"fl circle-box circle-left"}),s("div",{staticClass:"fr circle-box circle-right"})])}],r={name:"OrderList",props:{infoTitleLeft:{type:String,default:"左边标题"},isRight:{type:Boolean,default:!1},date:{type:String,default:"1970-01-01 00:00:00"},count:{type:Number,default:0},total:{type:[Number,String],default:0},isReceive:{type:Boolean,default:!1}},methods:{confirmReceive(){this.$emit("confirm-receive")},remove(){this.$emit("remove")}}},o=r,d=e(1001),l=(0,d.Z)(o,i,a,!1,null,"3c809507",null),c=l.exports},8577:function(t,s,e){e.r(s),e.d(s,{default:function(){return u}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"Pay"},[s("van-nav-bar",{attrs:{title:"订单结算","left-text":"返回",fixed:"","left-arrow":""},on:{"click-left":t.back}}),s("div",{staticClass:"pay-box"},[s("div",{staticClass:"select-address"},[s("div",{staticClass:"span"},[s("span",{on:{click:t.showSelectAddressList}},[t._v("选择地址 >")]),s("van-icon",{attrs:{"class-prefix":"arrow",name:"arrow"}})],1),s("div",{staticClass:"user-box"},[s("div",{staticClass:"user-name"},[t._v(t._s(t.currentAddress.name))]),s("div",{staticClass:"user-phone"},[t._v(t._s(t.currentAddress.tel))]),t.currentAddress.isDefault?s("div",{staticClass:"default-address"},[t._v("默认")]):t._e()]),s("div",{staticClass:"detail-address"},[t._v(t._s(t.currentAddress.address))])])]),s("div",{staticClass:"order-info",staticStyle:{"font-size":"20px"}},[s("OrderList",{attrs:{"info-title-left":"订单信息",count:t.productInfo.count,total:t.productInfo.total}},[t._l(t.products,(function(t,e){return s("OrderItem",{key:e,attrs:{item:t}})})),s("br")],2)],1),s("div",{staticClass:"btn-box"},[s("van-button",{attrs:{type:"primary",block:"",round:"",color:"#1A73E8"},on:{click:t.payBox}},[t._v("立即结算")])],1),s("van-popup",{attrs:{"is-link":"",position:"bottom",closeable:""},model:{value:t.isOpen,callback:function(s){t.isOpen=s},expression:"isOpen"}},[s("div",{staticClass:"address-title"},[t._v(" 选择地址")]),s("van-address-list",{attrs:{list:t.list,"default-tag-text":"默认"},on:{add:t.newAddress,select:t.selectAddress},model:{value:t.chosenAddressId,callback:function(s){t.chosenAddressId=s},expression:"chosenAddressId"}})],1)],1)},a=[],r=e(9569),o=e(7020),d={components:{OrderItem:r.Z,OrderList:o.Z},data(){return{isOpen:!1,chosenAddressId:"",currentAddress:[],sid:[],products:[],productInfo:{count:0,total:0},list:[],NewAddress:""}},created(){this.sids=this.$route.query.sids.split("-"),this.getAddressData(),this.getShopbagBySids()},methods:{back(){this.$router.go(-1)},newAddress(){this.$router.push({name:"NewAddress"})},selectAddress(t,s){this.isOpen=!1,this.currentAddress=t},showSelectAddressList(){this.isOpen=!0},getAddressData(){let t=localStorage.getItem("token");if(!t)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/findAddress",params:{appkey:this.appkey,tokenString:t}}).then((t=>{this.$toast.clear(),console.log("地址数据",t),700==t.data.code?this.$router.push({name:"Login"}):(t.data.code=2e4)&&(t.data.result.map((t=>{t.isDefault=Boolean(t.isDefault),t.id=t.aid,t.address=`${t.province}${t.city}${t.county}${t.addressDetall}`,t.isDefault&&(this.chosenAddressId=t.aid,this.currentAddress=t)})),this.list=t.data.result)})).catch((t=>{this.$toast.clear()}))},getShopbagBySids(){let t=localStorage.getItem("token");if(!t)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/commitShopcart",params:{appkey:this.appkey,tokenString:t,sids:JSON.stringify(this.sids)}}).then((t=>{if(console.log("订单数据",t),this.$toast.clear(),700==t.data.code)this.$router.push({name:"Login"});else if(5e4==t.data.code){if(0==t.data.result.length)return this.$router.push({name:"Home"});t.data.result.map((t=>{this.productInfo.count+=t.count,this.productInfo.total+=t.count*t.price})),this.products=t.data.result}else this.$toast(t.data.msg)})).catch((t=>{this.$toast.clear()}))},pay(){let t=localStorage.getItem("token");if(!t)return this.$toast("请先登录"),this.$router.push({name:"Login"});this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"POST",url:"/pay",data:{appkey:this.appkey,tokenString:t,sids:JSON.stringify(this.sids),phone:this.currentAddress.tel,address:this.currentAddress.address,recevier:this.currentAddress.name}}).then((t=>{this.$toast.clear(),console.log(t),700==t.data.code?this.$router.push({name:"Login"}):(this.$toast(t.data.msg),setTimeout((()=>{this.$router.push({name:"Order"})})))})).catch((t=>{this.$toast.clear()}))},payBox(){this.chosenAddressId?this.$dialog.confirm({title:"确认订单",message:"是否立即结算"}).then((()=>{this.pay()})).catch((t=>{})):this.$toast("请选择收货地址")}},components:{OrderItem:r.Z,OrderList:o.Z,OrderItem:r.Z}},l=d,c=e(1001),n=(0,c.Z)(l,i,a,!1,null,"59dd8e94",null),u=n.exports}}]);
//# sourceMappingURL=577.717b6173.js.map